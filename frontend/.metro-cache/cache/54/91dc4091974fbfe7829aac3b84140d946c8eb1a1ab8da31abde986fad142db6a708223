{"dependencies":[{"name":"../utils","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":12,"index":27},"end":{"line":3,"column":31,"index":46}}],"key":"RFGtgFE/Tu4zdfnbMKbFHDM/T4I=","exportNames":["*"],"imports":1}},{"name":"../stream/GenericWorker","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":20,"index":68},"end":{"line":4,"column":54,"index":102}}],"key":"P0ix7A+A5yoBAeWkvNGZrEnvjNU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var utils = require(_dependencyMap[0], \"../utils\");\n  var GenericWorker = require(_dependencyMap[1], \"../stream/GenericWorker\");\n\n  /**\n   * A worker that use a nodejs stream as source.\n   * @constructor\n   * @param {String} filename the name of the file entry for this stream.\n   * @param {Readable} stream the nodejs stream.\n   */\n  function NodejsStreamInputAdapter(filename, stream) {\n    GenericWorker.call(this, \"Nodejs stream input adapter for \" + filename);\n    this._upstreamEnded = false;\n    this._bindStream(stream);\n  }\n  utils.inherits(NodejsStreamInputAdapter, GenericWorker);\n\n  /**\n   * Prepare the stream and bind the callbacks on it.\n   * Do this ASAP on node 0.10 ! A lazy binding doesn't always work.\n   * @param {Stream} stream the nodejs stream to use.\n   */\n  NodejsStreamInputAdapter.prototype._bindStream = function (stream) {\n    var self = this;\n    this._stream = stream;\n    stream.pause();\n    stream.on(\"data\", function (chunk) {\n      self.push({\n        data: chunk,\n        meta: {\n          percent: 0\n        }\n      });\n    }).on(\"error\", function (e) {\n      if (self.isPaused) {\n        this.generatedError = e;\n      } else {\n        self.error(e);\n      }\n    }).on(\"end\", function () {\n      if (self.isPaused) {\n        self._upstreamEnded = true;\n      } else {\n        self.end();\n      }\n    });\n  };\n  NodejsStreamInputAdapter.prototype.pause = function () {\n    if (!GenericWorker.prototype.pause.call(this)) {\n      return false;\n    }\n    this._stream.pause();\n    return true;\n  };\n  NodejsStreamInputAdapter.prototype.resume = function () {\n    if (!GenericWorker.prototype.resume.call(this)) {\n      return false;\n    }\n    if (this._upstreamEnded) {\n      this.end();\n    } else {\n      this._stream.resume();\n    }\n    return true;\n  };\n  module.exports = NodejsStreamInputAdapter;\n});","lineCount":69,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0],[4,6,3,4,"utils"],[4,11,3,9],[4,14,3,12,"require"],[4,21,3,19],[4,22,3,19,"_dependencyMap"],[4,36,3,19],[4,51,3,30],[4,52,3,31],[5,2,4,0],[5,6,4,4,"GenericWorker"],[5,19,4,17],[5,22,4,20,"require"],[5,29,4,27],[5,30,4,27,"_dependencyMap"],[5,44,4,27],[5,74,4,53],[5,75,4,54],[7,2,6,0],[8,0,7,0],[9,0,8,0],[10,0,9,0],[11,0,10,0],[12,0,11,0],[13,2,12,0],[13,11,12,9,"NodejsStreamInputAdapter"],[13,35,12,33,"NodejsStreamInputAdapter"],[13,36,12,34,"filename"],[13,44,12,42],[13,46,12,44,"stream"],[13,52,12,50],[13,54,12,52],[14,4,13,4,"GenericWorker"],[14,17,13,17],[14,18,13,18,"call"],[14,22,13,22],[14,23,13,23],[14,27,13,27],[14,29,13,29],[14,63,13,63],[14,66,13,66,"filename"],[14,74,13,74],[14,75,13,75],[15,4,14,4],[15,8,14,8],[15,9,14,9,"_upstreamEnded"],[15,23,14,23],[15,26,14,26],[15,31,14,31],[16,4,15,4],[16,8,15,8],[16,9,15,9,"_bindStream"],[16,20,15,20],[16,21,15,21,"stream"],[16,27,15,27],[16,28,15,28],[17,2,16,0],[18,2,18,0,"utils"],[18,7,18,5],[18,8,18,6,"inherits"],[18,16,18,14],[18,17,18,15,"NodejsStreamInputAdapter"],[18,41,18,39],[18,43,18,41,"GenericWorker"],[18,56,18,54],[18,57,18,55],[20,2,20,0],[21,0,21,0],[22,0,22,0],[23,0,23,0],[24,0,24,0],[25,2,25,0,"NodejsStreamInputAdapter"],[25,26,25,24],[25,27,25,25,"prototype"],[25,36,25,34],[25,37,25,35,"_bindStream"],[25,48,25,46],[25,51,25,49],[25,61,25,59,"stream"],[25,67,25,65],[25,69,25,67],[26,4,26,4],[26,8,26,8,"self"],[26,12,26,12],[26,15,26,15],[26,19,26,19],[27,4,27,4],[27,8,27,8],[27,9,27,9,"_stream"],[27,16,27,16],[27,19,27,19,"stream"],[27,25,27,25],[28,4,28,4,"stream"],[28,10,28,10],[28,11,28,11,"pause"],[28,16,28,16],[28,17,28,17],[28,18,28,18],[29,4,29,4,"stream"],[29,10,29,10],[29,11,30,9,"on"],[29,13,30,11],[29,14,30,12],[29,20,30,18],[29,22,30,20],[29,32,30,30,"chunk"],[29,37,30,35],[29,39,30,37],[30,6,31,12,"self"],[30,10,31,16],[30,11,31,17,"push"],[30,15,31,21],[30,16,31,22],[31,8,32,16,"data"],[31,12,32,20],[31,14,32,22,"chunk"],[31,19,32,27],[32,8,33,16,"meta"],[32,12,33,20],[32,14,33,23],[33,10,34,20,"percent"],[33,17,34,27],[33,19,34,30],[34,8,35,16],[35,6,36,12],[35,7,36,13],[35,8,36,14],[36,4,37,8],[36,5,37,9],[36,6,37,10],[36,7,38,9,"on"],[36,9,38,11],[36,10,38,12],[36,17,38,19],[36,19,38,21],[36,29,38,31,"e"],[36,30,38,32],[36,32,38,34],[37,6,39,12],[37,10,39,15,"self"],[37,14,39,19],[37,15,39,20,"isPaused"],[37,23,39,28],[37,25,39,30],[38,8,40,16],[38,12,40,20],[38,13,40,21,"generatedError"],[38,27,40,35],[38,30,40,38,"e"],[38,31,40,39],[39,6,41,12],[39,7,41,13],[39,13,41,19],[40,8,42,16,"self"],[40,12,42,20],[40,13,42,21,"error"],[40,18,42,26],[40,19,42,27,"e"],[40,20,42,28],[40,21,42,29],[41,6,43,12],[42,4,44,8],[42,5,44,9],[42,6,44,10],[42,7,45,9,"on"],[42,9,45,11],[42,10,45,12],[42,15,45,17],[42,17,45,19],[42,29,45,31],[43,6,46,12],[43,10,46,15,"self"],[43,14,46,19],[43,15,46,20,"isPaused"],[43,23,46,28],[43,25,46,30],[44,8,47,16,"self"],[44,12,47,20],[44,13,47,21,"_upstreamEnded"],[44,27,47,35],[44,30,47,38],[44,34,47,42],[45,6,48,12],[45,7,48,13],[45,13,48,19],[46,8,49,16,"self"],[46,12,49,20],[46,13,49,21,"end"],[46,16,49,24],[46,17,49,25],[46,18,49,26],[47,6,50,12],[48,4,51,8],[48,5,51,9],[48,6,51,10],[49,2,52,0],[49,3,52,1],[50,2,53,0,"NodejsStreamInputAdapter"],[50,26,53,24],[50,27,53,25,"prototype"],[50,36,53,34],[50,37,53,35,"pause"],[50,42,53,40],[50,45,53,43],[50,57,53,55],[51,4,54,4],[51,8,54,7],[51,9,54,8,"GenericWorker"],[51,22,54,21],[51,23,54,22,"prototype"],[51,32,54,31],[51,33,54,32,"pause"],[51,38,54,37],[51,39,54,38,"call"],[51,43,54,42],[51,44,54,43],[51,48,54,47],[51,49,54,48],[51,51,54,50],[52,6,55,8],[52,13,55,15],[52,18,55,20],[53,4,56,4],[54,4,57,4],[54,8,57,8],[54,9,57,9,"_stream"],[54,16,57,16],[54,17,57,17,"pause"],[54,22,57,22],[54,23,57,23],[54,24,57,24],[55,4,58,4],[55,11,58,11],[55,15,58,15],[56,2,59,0],[56,3,59,1],[57,2,60,0,"NodejsStreamInputAdapter"],[57,26,60,24],[57,27,60,25,"prototype"],[57,36,60,34],[57,37,60,35,"resume"],[57,43,60,41],[57,46,60,44],[57,58,60,56],[58,4,61,4],[58,8,61,7],[58,9,61,8,"GenericWorker"],[58,22,61,21],[58,23,61,22,"prototype"],[58,32,61,31],[58,33,61,32,"resume"],[58,39,61,38],[58,40,61,39,"call"],[58,44,61,43],[58,45,61,44],[58,49,61,48],[58,50,61,49],[58,52,61,51],[59,6,62,8],[59,13,62,15],[59,18,62,20],[60,4,63,4],[61,4,65,4],[61,8,65,7],[61,12,65,11],[61,13,65,12,"_upstreamEnded"],[61,27,65,26],[61,29,65,28],[62,6,66,8],[62,10,66,12],[62,11,66,13,"end"],[62,14,66,16],[62,15,66,17],[62,16,66,18],[63,4,67,4],[63,5,67,5],[63,11,67,11],[64,6,68,8],[64,10,68,12],[64,11,68,13,"_stream"],[64,18,68,20],[64,19,68,21,"resume"],[64,25,68,27],[64,26,68,28],[64,27,68,29],[65,4,69,4],[66,4,71,4],[66,11,71,11],[66,15,71,15],[67,2,72,0],[67,3,72,1],[68,2,74,0,"module"],[68,8,74,6],[68,9,74,7,"exports"],[68,16,74,14],[68,19,74,17,"NodejsStreamInputAdapter"],[68,43,74,41],[69,0,74,42],[69,3]],"functionMap":{"names":["<global>","NodejsStreamInputAdapter","prototype._bindStream","stream.on$argument_1","stream.on.on$argument_1","stream.on.on.on$argument_1","prototype.pause","prototype.resume"],"mappings":"AAA;ACW;CDI;iDES;oBCK;SDO;qBEC;SFM;mBGC;SHM;CFC;2CMC;CNM;4COC;CPY"},"hasCjsExports":true},"type":"js/module"}]}