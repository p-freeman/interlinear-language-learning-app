{"dependencies":[{"name":"../utils","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":12,"index":27},"end":{"line":3,"column":31,"index":46}}],"key":"RFGtgFE/Tu4zdfnbMKbFHDM/T4I=","exportNames":["*"],"imports":1}},{"name":"./GenericWorker","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":20,"index":68},"end":{"line":4,"column":46,"index":94}}],"key":"qvnic9EAVDj4+n+vqDQ3xXHCHyo=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var utils = require(_dependencyMap[0], \"../utils\");\n  var GenericWorker = require(_dependencyMap[1], \"./GenericWorker\");\n\n  // the size of the generated chunks\n  // TODO expose this as a public variable\n  var DEFAULT_BLOCK_SIZE = 16 * 1024;\n\n  /**\n   * A worker that reads a content and emits chunks.\n   * @constructor\n   * @param {Promise} dataP the promise of the data to split\n   */\n  function DataWorker(dataP) {\n    GenericWorker.call(this, \"DataWorker\");\n    var self = this;\n    this.dataIsReady = false;\n    this.index = 0;\n    this.max = 0;\n    this.data = null;\n    this.type = \"\";\n    this._tickScheduled = false;\n    dataP.then(function (data) {\n      self.dataIsReady = true;\n      self.data = data;\n      self.max = data && data.length || 0;\n      self.type = utils.getTypeOf(data);\n      if (!self.isPaused) {\n        self._tickAndRepeat();\n      }\n    }, function (e) {\n      self.error(e);\n    });\n  }\n  utils.inherits(DataWorker, GenericWorker);\n\n  /**\n   * @see GenericWorker.cleanUp\n   */\n  DataWorker.prototype.cleanUp = function () {\n    GenericWorker.prototype.cleanUp.call(this);\n    this.data = null;\n  };\n\n  /**\n   * @see GenericWorker.resume\n   */\n  DataWorker.prototype.resume = function () {\n    if (!GenericWorker.prototype.resume.call(this)) {\n      return false;\n    }\n    if (!this._tickScheduled && this.dataIsReady) {\n      this._tickScheduled = true;\n      utils.delay(this._tickAndRepeat, [], this);\n    }\n    return true;\n  };\n\n  /**\n   * Trigger a tick a schedule an other call to this function.\n   */\n  DataWorker.prototype._tickAndRepeat = function () {\n    this._tickScheduled = false;\n    if (this.isPaused || this.isFinished) {\n      return;\n    }\n    this._tick();\n    if (!this.isFinished) {\n      utils.delay(this._tickAndRepeat, [], this);\n      this._tickScheduled = true;\n    }\n  };\n\n  /**\n   * Read and push a chunk.\n   */\n  DataWorker.prototype._tick = function () {\n    if (this.isPaused || this.isFinished) {\n      return false;\n    }\n    var size = DEFAULT_BLOCK_SIZE;\n    var data = null,\n      nextIndex = Math.min(this.max, this.index + size);\n    if (this.index >= this.max) {\n      // EOF\n      return this.end();\n    } else {\n      switch (this.type) {\n        case \"string\":\n          data = this.data.substring(this.index, nextIndex);\n          break;\n        case \"uint8array\":\n          data = this.data.subarray(this.index, nextIndex);\n          break;\n        case \"array\":\n        case \"nodebuffer\":\n          data = this.data.slice(this.index, nextIndex);\n          break;\n      }\n      this.index = nextIndex;\n      return this.push({\n        data: data,\n        meta: {\n          percent: this.max ? this.index / this.max * 100 : 0\n        }\n      });\n    }\n  };\n  module.exports = DataWorker;\n});","lineCount":112,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0],[4,6,3,4,"utils"],[4,11,3,9],[4,14,3,12,"require"],[4,21,3,19],[4,22,3,19,"_dependencyMap"],[4,36,3,19],[4,51,3,30],[4,52,3,31],[5,2,4,0],[5,6,4,4,"GenericWorker"],[5,19,4,17],[5,22,4,20,"require"],[5,29,4,27],[5,30,4,27,"_dependencyMap"],[5,44,4,27],[5,66,4,45],[5,67,4,46],[7,2,6,0],[8,2,7,0],[9,2,8,0],[9,6,8,4,"DEFAULT_BLOCK_SIZE"],[9,24,8,22],[9,27,8,25],[9,29,8,27],[9,32,8,30],[9,36,8,34],[11,2,10,0],[12,0,11,0],[13,0,12,0],[14,0,13,0],[15,0,14,0],[16,2,15,0],[16,11,15,9,"DataWorker"],[16,21,15,19,"DataWorker"],[16,22,15,20,"dataP"],[16,27,15,25],[16,29,15,27],[17,4,16,4,"GenericWorker"],[17,17,16,17],[17,18,16,18,"call"],[17,22,16,22],[17,23,16,23],[17,27,16,27],[17,29,16,29],[17,41,16,41],[17,42,16,42],[18,4,17,4],[18,8,17,8,"self"],[18,12,17,12],[18,15,17,15],[18,19,17,19],[19,4,18,4],[19,8,18,8],[19,9,18,9,"dataIsReady"],[19,20,18,20],[19,23,18,23],[19,28,18,28],[20,4,19,4],[20,8,19,8],[20,9,19,9,"index"],[20,14,19,14],[20,17,19,17],[20,18,19,18],[21,4,20,4],[21,8,20,8],[21,9,20,9,"max"],[21,12,20,12],[21,15,20,15],[21,16,20,16],[22,4,21,4],[22,8,21,8],[22,9,21,9,"data"],[22,13,21,13],[22,16,21,16],[22,20,21,20],[23,4,22,4],[23,8,22,8],[23,9,22,9,"type"],[23,13,22,13],[23,16,22,16],[23,18,22,18],[24,4,24,4],[24,8,24,8],[24,9,24,9,"_tickScheduled"],[24,23,24,23],[24,26,24,26],[24,31,24,31],[25,4,26,4,"dataP"],[25,9,26,9],[25,10,26,10,"then"],[25,14,26,14],[25,15,26,15],[25,25,26,25,"data"],[25,29,26,29],[25,31,26,31],[26,6,27,8,"self"],[26,10,27,12],[26,11,27,13,"dataIsReady"],[26,22,27,24],[26,25,27,27],[26,29,27,31],[27,6,28,8,"self"],[27,10,28,12],[27,11,28,13,"data"],[27,15,28,17],[27,18,28,20,"data"],[27,22,28,24],[28,6,29,8,"self"],[28,10,29,12],[28,11,29,13,"max"],[28,14,29,16],[28,17,29,19,"data"],[28,21,29,23],[28,25,29,27,"data"],[28,29,29,31],[28,30,29,32,"length"],[28,36,29,38],[28,40,29,42],[28,41,29,43],[29,6,30,8,"self"],[29,10,30,12],[29,11,30,13,"type"],[29,15,30,17],[29,18,30,20,"utils"],[29,23,30,25],[29,24,30,26,"getTypeOf"],[29,33,30,35],[29,34,30,36,"data"],[29,38,30,40],[29,39,30,41],[30,6,31,8],[30,10,31,11],[30,11,31,12,"self"],[30,15,31,16],[30,16,31,17,"isPaused"],[30,24,31,25],[30,26,31,27],[31,8,32,12,"self"],[31,12,32,16],[31,13,32,17,"_tickAndRepeat"],[31,27,32,31],[31,28,32,32],[31,29,32,33],[32,6,33,8],[33,4,34,4],[33,5,34,5],[33,7,34,7],[33,17,34,17,"e"],[33,18,34,18],[33,20,34,20],[34,6,35,8,"self"],[34,10,35,12],[34,11,35,13,"error"],[34,16,35,18],[34,17,35,19,"e"],[34,18,35,20],[34,19,35,21],[35,4,36,4],[35,5,36,5],[35,6,36,6],[36,2,37,0],[37,2,39,0,"utils"],[37,7,39,5],[37,8,39,6,"inherits"],[37,16,39,14],[37,17,39,15,"DataWorker"],[37,27,39,25],[37,29,39,27,"GenericWorker"],[37,42,39,40],[37,43,39,41],[39,2,41,0],[40,0,42,0],[41,0,43,0],[42,2,44,0,"DataWorker"],[42,12,44,10],[42,13,44,11,"prototype"],[42,22,44,20],[42,23,44,21,"cleanUp"],[42,30,44,28],[42,33,44,31],[42,45,44,43],[43,4,45,4,"GenericWorker"],[43,17,45,17],[43,18,45,18,"prototype"],[43,27,45,27],[43,28,45,28,"cleanUp"],[43,35,45,35],[43,36,45,36,"call"],[43,40,45,40],[43,41,45,41],[43,45,45,45],[43,46,45,46],[44,4,46,4],[44,8,46,8],[44,9,46,9,"data"],[44,13,46,13],[44,16,46,16],[44,20,46,20],[45,2,47,0],[45,3,47,1],[47,2,49,0],[48,0,50,0],[49,0,51,0],[50,2,52,0,"DataWorker"],[50,12,52,10],[50,13,52,11,"prototype"],[50,22,52,20],[50,23,52,21,"resume"],[50,29,52,27],[50,32,52,30],[50,44,52,42],[51,4,53,4],[51,8,53,7],[51,9,53,8,"GenericWorker"],[51,22,53,21],[51,23,53,22,"prototype"],[51,32,53,31],[51,33,53,32,"resume"],[51,39,53,38],[51,40,53,39,"call"],[51,44,53,43],[51,45,53,44],[51,49,53,48],[51,50,53,49],[51,52,53,51],[52,6,54,8],[52,13,54,15],[52,18,54,20],[53,4,55,4],[54,4,57,4],[54,8,57,8],[54,9,57,9],[54,13,57,13],[54,14,57,14,"_tickScheduled"],[54,28,57,28],[54,32,57,32],[54,36,57,36],[54,37,57,37,"dataIsReady"],[54,48,57,48],[54,50,57,50],[55,6,58,8],[55,10,58,12],[55,11,58,13,"_tickScheduled"],[55,25,58,27],[55,28,58,30],[55,32,58,34],[56,6,59,8,"utils"],[56,11,59,13],[56,12,59,14,"delay"],[56,17,59,19],[56,18,59,20],[56,22,59,24],[56,23,59,25,"_tickAndRepeat"],[56,37,59,39],[56,39,59,41],[56,41,59,43],[56,43,59,45],[56,47,59,49],[56,48,59,50],[57,4,60,4],[58,4,61,4],[58,11,61,11],[58,15,61,15],[59,2,62,0],[59,3,62,1],[61,2,64,0],[62,0,65,0],[63,0,66,0],[64,2,67,0,"DataWorker"],[64,12,67,10],[64,13,67,11,"prototype"],[64,22,67,20],[64,23,67,21,"_tickAndRepeat"],[64,37,67,35],[64,40,67,38],[64,52,67,49],[65,4,68,4],[65,8,68,8],[65,9,68,9,"_tickScheduled"],[65,23,68,23],[65,26,68,26],[65,31,68,31],[66,4,69,4],[66,8,69,7],[66,12,69,11],[66,13,69,12,"isPaused"],[66,21,69,20],[66,25,69,24],[66,29,69,28],[66,30,69,29,"isFinished"],[66,40,69,39],[66,42,69,41],[67,6,70,8],[68,4,71,4],[69,4,72,4],[69,8,72,8],[69,9,72,9,"_tick"],[69,14,72,14],[69,15,72,15],[69,16,72,16],[70,4,73,4],[70,8,73,7],[70,9,73,8],[70,13,73,12],[70,14,73,13,"isFinished"],[70,24,73,23],[70,26,73,25],[71,6,74,8,"utils"],[71,11,74,13],[71,12,74,14,"delay"],[71,17,74,19],[71,18,74,20],[71,22,74,24],[71,23,74,25,"_tickAndRepeat"],[71,37,74,39],[71,39,74,41],[71,41,74,43],[71,43,74,45],[71,47,74,49],[71,48,74,50],[72,6,75,8],[72,10,75,12],[72,11,75,13,"_tickScheduled"],[72,25,75,27],[72,28,75,30],[72,32,75,34],[73,4,76,4],[74,2,77,0],[74,3,77,1],[76,2,79,0],[77,0,80,0],[78,0,81,0],[79,2,82,0,"DataWorker"],[79,12,82,10],[79,13,82,11,"prototype"],[79,22,82,20],[79,23,82,21,"_tick"],[79,28,82,26],[79,31,82,29],[79,43,82,40],[80,4,84,4],[80,8,84,7],[80,12,84,11],[80,13,84,12,"isPaused"],[80,21,84,20],[80,25,84,24],[80,29,84,28],[80,30,84,29,"isFinished"],[80,40,84,39],[80,42,84,41],[81,6,85,8],[81,13,85,15],[81,18,85,20],[82,4,86,4],[83,4,88,4],[83,8,88,8,"size"],[83,12,88,12],[83,15,88,15,"DEFAULT_BLOCK_SIZE"],[83,33,88,33],[84,4,89,4],[84,8,89,8,"data"],[84,12,89,12],[84,15,89,15],[84,19,89,19],[85,6,89,21,"nextIndex"],[85,15,89,30],[85,18,89,33,"Math"],[85,22,89,37],[85,23,89,38,"min"],[85,26,89,41],[85,27,89,42],[85,31,89,46],[85,32,89,47,"max"],[85,35,89,50],[85,37,89,52],[85,41,89,56],[85,42,89,57,"index"],[85,47,89,62],[85,50,89,65,"size"],[85,54,89,69],[85,55,89,70],[86,4,90,4],[86,8,90,8],[86,12,90,12],[86,13,90,13,"index"],[86,18,90,18],[86,22,90,22],[86,26,90,26],[86,27,90,27,"max"],[86,30,90,30],[86,32,90,32],[87,6,91,8],[88,6,92,8],[88,13,92,15],[88,17,92,19],[88,18,92,20,"end"],[88,21,92,23],[88,22,92,24],[88,23,92,25],[89,4,93,4],[89,5,93,5],[89,11,93,11],[90,6,94,8],[90,14,94,15],[90,18,94,19],[90,19,94,20,"type"],[90,23,94,24],[91,8,95,8],[91,13,95,13],[91,21,95,21],[92,10,96,12,"data"],[92,14,96,16],[92,17,96,19],[92,21,96,23],[92,22,96,24,"data"],[92,26,96,28],[92,27,96,29,"substring"],[92,36,96,38],[92,37,96,39],[92,41,96,43],[92,42,96,44,"index"],[92,47,96,49],[92,49,96,51,"nextIndex"],[92,58,96,60],[92,59,96,61],[93,10,97,12],[94,8,98,8],[94,13,98,13],[94,25,98,25],[95,10,99,12,"data"],[95,14,99,16],[95,17,99,19],[95,21,99,23],[95,22,99,24,"data"],[95,26,99,28],[95,27,99,29,"subarray"],[95,35,99,37],[95,36,99,38],[95,40,99,42],[95,41,99,43,"index"],[95,46,99,48],[95,48,99,50,"nextIndex"],[95,57,99,59],[95,58,99,60],[96,10,100,12],[97,8,101,8],[97,13,101,13],[97,20,101,20],[98,8,102,8],[98,13,102,13],[98,25,102,25],[99,10,103,12,"data"],[99,14,103,16],[99,17,103,19],[99,21,103,23],[99,22,103,24,"data"],[99,26,103,28],[99,27,103,29,"slice"],[99,32,103,34],[99,33,103,35],[99,37,103,39],[99,38,103,40,"index"],[99,43,103,45],[99,45,103,47,"nextIndex"],[99,54,103,56],[99,55,103,57],[100,10,104,12],[101,6,105,8],[102,6,106,8],[102,10,106,12],[102,11,106,13,"index"],[102,16,106,18],[102,19,106,21,"nextIndex"],[102,28,106,30],[103,6,107,8],[103,13,107,15],[103,17,107,19],[103,18,107,20,"push"],[103,22,107,24],[103,23,107,25],[104,8,108,12,"data"],[104,12,108,16],[104,14,108,19,"data"],[104,18,108,23],[105,8,109,12,"meta"],[105,12,109,16],[105,14,109,19],[106,10,110,16,"percent"],[106,17,110,23],[106,19,110,26],[106,23,110,30],[106,24,110,31,"max"],[106,27,110,34],[106,30,110,37],[106,34,110,41],[106,35,110,42,"index"],[106,40,110,47],[106,43,110,50],[106,47,110,54],[106,48,110,55,"max"],[106,51,110,58],[106,54,110,61],[106,57,110,64],[106,60,110,67],[107,8,111,12],[108,6,112,8],[108,7,112,9],[108,8,112,10],[109,4,113,4],[110,2,114,0],[110,3,114,1],[111,2,116,0,"module"],[111,8,116,6],[111,9,116,7,"exports"],[111,16,116,14],[111,19,116,17,"DataWorker"],[111,29,116,27],[112,0,116,28],[112,3]],"functionMap":{"names":["<global>","DataWorker","dataP.then$argument_0","dataP.then$argument_1","prototype.cleanUp","prototype.resume","prototype._tickAndRepeat","prototype._tick"],"mappings":"AAA;ACc;eCW;KDQ,EE;KFE;CDC;+BIO;CJG;8BKK;CLU;sCMK;CNU;6BOK;CPgC"},"hasCjsExports":true},"type":"js/module"}]}